!function(){"use strict";window.Navy={View:{},ViewGroup:{}};window.addEventListener("DOMContentLoaded",function(){Navy.App.initialize()});Navy.Class=function(){var t;var e;switch(arguments.length){case 1:e=Navy.Class._RootClass;t=arguments[0];break;case 2:if(typeof arguments[0]==="function"){e=arguments[0]}else{e=arguments[0].constructor}t=arguments[1];break;default:throw new Error("arguments of Navy.Class is 1 or 2.")}return Navy.Class._create(e,t)};Navy.Class.instance=function t(t){var e=Navy.Class.apply(Navy,arguments);e.__manualInitialize__=true;var n=new e;return n};Navy.Class._RootClass=function e(){};Navy.Class._RootClass.prototype.initialize=function(){};Navy.Class._create=function n(t,e){var n=e.CLASSNAME||"Constructor";n=n.replace(/[.]/g,"$");var a=new Function("return function "+n+" () { if (typeof this.initialize === 'function' && !this.constructor.__manualInitialize__) { this.initialize.apply(this, arguments); } }")();function i(){}i.prototype=t.prototype;var o=new i;var s=new i;a.prototype=o;var r;var l;for(r in e){l=e[r];if(typeof l==="object"&&l!==null){if(r!=="$static"){throw new Error("object property must be primitive type. property = "+r)}}if(typeof l==="function"){if(Navy.Class._argumentNames(l)[0]==="$super"){l=Navy.Class._wrapFunction(s,r,l)}}a.prototype[r]=l}a.prototype.constructor=a;return a};Navy.Class._argumentNames=function a(t){var e=t.toString().match(/^[\s\(]*function[^(]*\(([^)]*)\)/)[1].replace(/\/\/.*?[\r\n]|\/\*(?:.|[\r\n])*?\*\//g,"").replace(/\s+/g,"").split(",");return e.length==1&&!e[0]?[]:e};Navy.Class._wrapFunction=function i(t,e,n){if(typeof t[e]!=="function"){throw new Error("override method must be function. function = "+e)}return function(){var a=this;var $super=function(){return t[e].apply(a,arguments)};var i=[$super].concat(Array.prototype.slice.call(arguments,0));return n.apply(this,i)}};Navy.Notify=Navy.Class({CLASSNAME:"Navy.Notify",_count:null,_callback:null,initialize:function(t,e){if(arguments.length===2){this.set(t,e)}},pass:function(){this._count--;if(this._count===0){this._callback()}},set:function(t,e){if(t===0){e()}else{this._count=t;this._callback=e}}});Navy.App=Navy.Class.instance({CLASSNAME:"Navy.App",_appConfig:null,_sceneConfig:null,initialize:function(){var t=new Navy.Notify(2,this._onLoadAllConfig.bind(this));this._loadAppJSON(t.pass.bind(t));this._loadSceneJSON(t.pass.bind(t))},_loadAppJSON:function(t){var e=new XMLHttpRequest;e.open("GET","config/app.json");e.onload=function(e){var n=e.target;this._appConfig=JSON.parse(n.responseText);t()}.bind(this);e.send()},_loadSceneJSON:function(t){var e=new XMLHttpRequest;e.open("GET","config/scene.json");e.onload=function(e){var n=e.target;this._sceneConfig=JSON.parse(n.responseText);t()}.bind(this);e.send()},_onLoadAllConfig:function(){var t=this._appConfig.size;Navy.Screen.initialize(this._appConfig,this._sceneConfig,t.width,t.height)}});Navy.Screen=Navy.Class.instance({CLASSNAME:"Navy.Screen",_screenElm:null,initialize:function(t,e,n,a){var i="* {margin:0; padding:0;} html {width:100%; height:100%} body {background-color:#000;}";var o=document.createElement("style");o.textContent=i;document.head.appendChild(o);var s=window.innerWidth;var r=window.innerHeight;var l=s/n;var u=r/a;var c=Math.min(l,u);var v=(s-c*n)/2;var y=(r-c*a)/2;document.body.style.position="absolute";document.body.style.zoom=c;document.body.style.width=n+"px";document.body.style.height=a+"px";document.body.style.left=v+"px";document.body.style.top=y+"px";this._screenElm=document.body;var p=t.start.scene;var d=e[p];Navy.ResourceManager.initialize();var f=new Navy.Notify(2,this._onLoadResource.bind(this,d));Navy.ResourceManager.loadLayout(d.extra.contentLayoutFile,f.pass.bind(f));Navy.ResourceManager.loadScript(d.classFile,f.pass.bind(f))},_onLoadResource:function(t){Navy.Root.initialize(this._screenElm);var e=Navy.ResourceManager.getClass(t.class);var n=new e(t);Navy.Root.addView(n)}});Navy.View.View=Navy.Class({CLASSNAME:"Navy.View.View",_layout:null,_parentElement:null,_element:null,initialize:function(t){var e=document.createElement("div");if(t){var n={position:"absolute",left:t.pos.x,top:t.pos.y,width:t.size.width+"px",height:t.size.height+"px","background-color":t.backgroundColor};var a=this.convertStyleToCSSText(n);e.style.cssText=a}this._layout=t;this._element=e},convertStyleToCSSText:function(t){var e="";for(var n in t){var a=t[n];if(a!==undefined){e+=n+":"+a+";"}}return e},onChangeParentElement:function(t,e){this._parentElement=e},getId:function(){return this._layout.id},getElement:function(){return this._element},getParentElement:function(){return this._parentElement}});Navy.View.Text=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.View.Text",initialize:function($super,t){$super(t);this._element.textContent=t.extra.text}});Navy.ViewGroup.ViewGroup=Navy.Class(Navy.View.View,{CLASSNAME:"Navy.ViewGroup.ViewGroup",_views:null,initialize:function($super,t){$super(t);this._views={};if(t&&t.extra.contentLayoutFile){var e=t.extra.contentLayoutFile;var n=Navy.ResourceManager.getLayout(e);for(var a=0;a<n.length;a++){var i=n[a];var o=Navy.ResourceManager.getClass(i.class);var s=new o(i);this.addView(s)}}},addView:function(t){var e=t.getElement();var n=t.getParentElement();this._element.appendChild(e);this._views[t.getId()]=t;t.onChangeParentElement(n,this._element)}});Navy.Root=Navy.Class.instance(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Root",initialize:function($super,t){$super();var e=document.createElement("div");e.style.cssText="position:absolute; width:100%; height:100%;";t.appendChild(e);e.style.backgroundColor="red";this._element=e}});Navy.Scene=Navy.Class(Navy.ViewGroup.ViewGroup,{CLASSNAME:"Navy.Scene",initialize:function($super,t){$super(t);console.log(t)}});Navy.ResourceManager=Navy.Class.instance({CLASSNAME:"Navy.ResourceManager",_layouts:null,_scripts:null,initialize:function(){this._layouts={};this._scripts={}},loadLayout:function(t,e){var n=new XMLHttpRequest;n.open("GET",t);n.onload=function(n){var a=n.target;var i=a.responseText;this._layouts[t]=i;e()}.bind(this);n.send()},loadScript:function(t,e){var n=document.createElement("script");n.onload=function(){this._scripts[t]=true;e()}.bind(this);n.src=t;document.head.appendChild(n)},getLayout:function(t){var e=this._layouts[t];if(e){return JSON.parse(e)}else{throw new Error("not loaded layout. layoutFile = "+t)}},getClass:function(t){var e=t.split(".");var n=window;for(var a=0;a<e.length;a++){n=n[e[a]]}return n}})}();